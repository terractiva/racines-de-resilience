@use "sass:list";
@use "sass:math";
@import "_variables.scss";

$treeWidth: 6000;
$treeHeight: 4238;
$landscapeHeight: 100vh;
$landscapeWidth: math.div($treeWidth, $treeHeight) * 100vh;
$portraitHeight: math.div($treeHeight, $treeWidth) * 100vw;
$portraitWidth: 100vw;
$actionLandscapeFontSize: 0.004 * $landscapeHeight;
$actionPortraitFontSize: 0.004 * $portraitHeight;
$actionLandscapeSeparatorSize: 0.001 * $landscapeHeight;
$actionPortraitSeparatorSize: 0.001 * $portraitHeight;

@mixin mediaPortrait() {
  @media (max-aspect-ratio: list.slash($treeWidth, $treeHeight)) {
    @content;
  }
}

@font-face {
  font-family: 'Police Action Arbre';
  src: url('/police-action-arbre.woff2') format('woff2'),
      url('/police-action-arbre.woff') format('woff');
  font-weight: bold;
  font-style: normal;
  font-display: swap;
}

html, body, main {
  height: 100%;
}

html {
  background-color: $white;
}

.navbar {
  height: $navbar-height;
}

main {
  display: flex;
}

.tree {
  &-container {
    height: $landscapeHeight;
    margin: auto;
    position: relative;
    width: $landscapeWidth;

    @include mediaPortrait {
      height: $portraitHeight;
      width: $portraitWidth;
    }
  }

  &-image {
    display: block;
    height: 100%;
    object-fit: contain;
    width: 100%;
  }

  &-actions {
    height: 100%;
    left: 0;
    position: absolute;
    top: 0;
    width: 100%;
  }

  &-action {
    position: absolute;
    overflow: hidden;

    @mixin tree-action-variant($pair) {
      .tree-action-sources {
        color: nth($pair, 4);
      }
    }
    &.is-build {
      @include tree-action-variant(map-get($colors, 'build'));

      &.is-regenerate {
        @include tree-action-variant(map-get($colors, 'build-regenerate'));
      }
    }
    &.is-regenerate {
      @include tree-action-variant(map-get($colors, 'regenerate'));

      &.is-intervene {
        @include tree-action-variant(map-get($colors, 'regenerate-intervene'));
      }
    }
    &.is-intervene {
      @include tree-action-variant(map-get($colors, 'intervene'));
    }

    &, &::before, button {
      border-radius: 50%;
    }
    &::before {
      content: '';
      display: block;
      padding-bottom: 100%;
    }
    button {
      align-items: center;
      background: transparent;
      border: 0;
      display: flex;
      flex-direction: column;
      height: 100%;
      justify-content: center;
      left: 0;
      padding: 15%; // Valeur approximative permettant de faire rentrer un carr√© dans un cercle
      position: absolute;
      top: 0;
      width: 100%;

      &:hover {
        opacity: 0.6;
      }
    }
    &-name, &-sources {
      font-size: $actionLandscapeFontSize;
      font-weight: $weight-semibold;
      line-height: 1.2;
      text-align: center;

      @include mediaPortrait() {
        font-size: $actionPortraitFontSize;
      }
    }
    &-separator {
      border-bottom: solid $grey;
      border-right: solid $grey;
      border-width: $actionLandscapeSeparatorSize;
      margin-bottom: 2 * $actionLandscapeSeparatorSize;
      margin-top: $actionLandscapeSeparatorSize;
      transform: rotate(45deg);
      width: 2 * $actionLandscapeSeparatorSize;

      @include mediaPortrait() {
        border-width: $actionPortraitSeparatorSize;
        margin-bottom: 2 * $actionPortraitSeparatorSize;
        margin-top: $actionPortraitSeparatorSize;
        width: 2 * $actionPortraitSeparatorSize;
      }

      &::before {
        content: '';
        display: block;
        padding-bottom: 100%;
      }
    }
    &-sources {
      font-family: "Police Action Arbre", $family-sans-serif;
    }
  }

  &-buttons {
    position: absolute;
    right: 50%;
    top: $navbar-height + 0.5rem;
    transform: translateX(50%);

    @include mobile {
      right: 0;
      transform: none;
    }
  }

  &-dropdowns {
    left: $size-7;
    position: absolute;
    top: $navbar-height + 0.5rem;

    details {
      margin-bottom: 0;
    }
    &-credits .dropdown-menu {
      max-width: calc(100vw - 2 * $size-7);
      width: 35rem;
    }
  }
}
